var i=e=>{throw new Error("Not initialized yet")},l=typeof window>"u"&&typeof globalThis.WebSocketPair>"u";typeof Deno>"u"&&(self.Deno={args:[],build:{arch:"x86_64"},env:{get(){}}});var d=new Map,c=0;l&&(globalThis.syscall=async(e,...t)=>await new Promise((r,s)=>{c++,d.set(c,{resolve:r,reject:s}),i({type:"sys",id:c,name:e,args:t})}));function y(e,t,r){l&&(i=r,self.addEventListener("message",s=>{(async()=>{let n=s.data;switch(n.type){case"inv":{let a=e[n.name];if(!a)throw new Error(`Function not loaded: ${n.name}`);try{let o=await Promise.resolve(a(...n.args||[]));i({type:"invr",id:n.id,result:o})}catch(o){console.error("An exception was thrown as a result of invoking function",n.name,"error:",o.message),i({type:"invr",id:n.id,error:o.message})}}break;case"sysr":{let a=n.id,o=d.get(a);if(!o)throw Error("Invalid request id");d.delete(a),n.error?o.reject(new Error(n.error)):o.resolve(n.result)}break}})().catch(console.error)}),i({type:"manifest",manifest:t}))}function f(e){let t=atob(e),r=t.length,s=new Uint8Array(r);for(let n=0;n<r;n++)s[n]=t.charCodeAt(n);return s}function u(e){typeof e=="string"&&(e=new TextEncoder().encode(e));let t="",r=e.byteLength;for(let s=0;s<r;s++)t+=String.fromCharCode(e[s]);return btoa(t)}async function p(e,t){if(typeof e!="string"){let r=new Uint8Array(await e.arrayBuffer()),s=r.length>0?u(r):void 0;t={method:e.method,headers:Object.fromEntries(e.headers.entries()),base64Body:s},e=e.url}return syscall("sandboxFetch.fetch",e,t)}globalThis.nativeFetch=globalThis.fetch;function m(){globalThis.fetch=async function(e,t){let r=t&&t.body?u(new Uint8Array(await new Response(t.body).arrayBuffer())):void 0,s=await p(e,t&&{method:t.method,headers:t.headers,base64Body:r});return new Response(s.base64Body?f(s.base64Body):null,{status:s.status,headers:s.headers})}}l&&m();var g={},h={name:"silverbullet-ai",requiredPermissions:["fetch"],assets:{},functions:{}},v={manifest:h,functionMapping:g};y(g,h,self.postMessage);export{v as plug};
